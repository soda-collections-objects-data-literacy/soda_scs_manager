# Helpers

# @todo Refactor to use entity type as parameter for just one route
soda_scs_manager.component.health_check:
  path: '/soda-scs-manager/health/component/{component_id}'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsComponentController::componentStatus'
    _title:  'Component Health Check'
  requirements:
    _permission: 'soda scs manager user'
  options:
    no_cache: TRUE

soda_scs_manager.stack.health_check:
  path: '/soda-scs-manager/health/stack/{stack_id}'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsStackController::stackStatus'
    _title:  'Stack Health Check'
  requirements:
    _permission: 'soda scs manager user'
  options:
    no_cache: TRUE

soda_scs_manager.progress.latest_steps:
  path: '/soda-scs-manager/progress/{operation_uuid}/latest-steps'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsProgressController::getLatestSteps'
    _title: 'Get latest steps for operation'
  requirements:
    _permission: 'soda scs manager user'
    operation_uuid: '[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}'
  options:
    no_cache: TRUE


# Soda SCS Component Entities

entity.soda_scs_component.canonical:
  path: '/soda-scs-manager/component/{soda_scs_component}'
  defaults:
    _entity_view: 'soda_scs_component.default'
    _title: 'SCS Component'
  options:
    parameters:
      soda_scs_component:
        type: entity:soda_scs_component
    no_cache: TRUE
  requirements:
    _permission: 'soda scs manager user'

entity.soda_scs_component.add_form:
  path: '/soda-scs-manager/component/add/{bundle}'
  defaults:
    _entity_form: 'soda_scs_component.add'
    _title: 'Add SCS Component'
  requirements:
    _permission: 'soda scs manager user'

entity.soda_scs_component.edit_form:
  path: '/soda-scs-manager/component/{soda_scs_component}/edit'
  defaults:
    _entity_form: 'soda_scs_component.edit'
    _title: 'Edit SCS Component'
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsComponentLinksTasksAccessControlHandler::accessEditForm'
  options:
    parameters:
      soda_scs_component:
        type: entity:soda_scs_component

entity.soda_scs_component.delete_form:
  path: '/soda-scs-manager/component/{soda_scs_component}/delete'
  defaults:
    _entity_form: 'soda_scs_component.delete'
    _title: 'Delete SCS Component'
  options:
    parameters:
      soda_scs_component:
        type: entity:soda_scs_component
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsComponentLinksTasksAccessControlHandler::accessDeleteForm'

entity.soda_scs_component.collection:
  path: '/admin/structure/soda-scs-component/list'
  defaults:
    _entity_list: 'soda_scs_component'
    _title: 'SODa SCS Components'
  requirements:
    _permission: 'soda scs manager user'
  options:
    no_cache: TRUE

entity.soda_scs_component.automated_updates:
  path: '/soda-scs-manager/component/automated-updates'
  defaults:
    _form: '\Drupal\soda_scs_manager\Form\SodaScsComponentAutomatedUpdatesConfirmForm'
    _title: 'Update all components'
  requirements:
    _permission: 'soda scs manager admin'
  options:
    no_cache: TRUE

entity.soda_scs_component.snapshot:
  path: '/soda-scs-manager/component/{soda_scs_component}/snapshot'
  defaults:
    _form: '\Drupal\soda_scs_manager\Form\SodaScsSnapshotConfirmForm'
    _title: 'Create Snapshot'
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsComponentLinksTasksAccessControlHandler::accessSnapshotForm'
  options:
    parameters:
      soda_scs_component:
        type: entity:soda_scs_component

# SODa SCS Project Entities

entity.soda_scs_project.canonical:
  path: '/soda-scs-manager/project/{soda_scs_project}'
  defaults:
    _entity_view: 'soda_scs_project.default'
    _title: 'SODa SCS Project'
  options:
    parameters:
      soda_scs_project:
        type: entity:soda_scs_project
  requirements:
    _permission: 'soda scs manager user'

entity.soda_scs_project.add_form:
  path: '/soda-scs-manager/project/add/{bundle}'
  defaults:
    _entity_form: 'soda_scs_project.add'
    _title: 'Add SODa SCS Project'
    bundle: 'soda_scs_project'
  requirements:
    _permission: 'soda scs manager user'

entity.soda_scs_project.edit_form:
  path: '/soda-scs-manager/project/{soda_scs_project}/edit'
  defaults:
    _entity_form: 'soda_scs_project.edit'
    _title: 'Edit SODa SCS Project'
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsProjectAccessControlHandler::accessEditForm'

entity.soda_scs_project.delete_form:
  path: '/soda-scs-manager/project/{soda_scs_project}/delete'
  defaults:
    _entity_form: 'soda_scs_project.delete'
    _title: 'Delete SODa SCS Project'
  options:
    parameters:
      soda_scs_project:
        type: entity:soda_scs_project
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsProjectAccessControlHandler::accessDeleteForm'

entity.soda_scs_project.leave_form:
  path: '/soda-scs-manager/project/{soda_scs_project}/leave'
  defaults:
    _entity_form: 'soda_scs_project.leave'
    _title: 'Leave SODa SCS Project'
  options:
    parameters:
      soda_scs_project:
        type: entity:soda_scs_project
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsProjectAccessControlHandler::accessLeaveForm'

entity.soda_scs_project.collection:
  path: '/admin/structure/soda-scs-project/list'
  defaults:
    _entity_list: 'soda_scs_project'
    _title: 'SODa SCS Projects'
  requirements:
    _permission: 'soda scs manager user'


# SODa SCS Service Key Entities

entity.soda_scs_service_key.canonical:
  path: '/soda-scs-manager/service-key/{soda_scs_service_key}'
  defaults:
    _entity_view: 'soda_scs_service_key.default'
    _title: 'SODa SCS Service Key'
  options:
    parameters:
      soda_scs_service_key:
        type: entity:soda_scs_service_key
  requirements:
    _entity_access: 'soda_scs_service_key.view'

entity.soda_scs_service_key.add_form:
  path: '/soda-scs-manager/service-key/add/{bundle}'
  defaults:
    _entity_form: 'soda_scs_service_key.add'
    _title: 'Add SODa SCS Service Key'
    bundle: 'soda_scs_service_key'
  requirements:
    _permission: 'soda scs manager admin'

entity.soda_scs_service_key.delete_form:
  path: '/soda-scs-manager/service-key/{soda_scs_service_key}/delete'
  defaults:
    _entity_form: 'soda_scs_service_key.delete'
    _title: 'Delete SODa SCS Service Key'
  options:
    parameters:
      soda_scs_service_key:
        type: entity:soda_scs_service_key
  requirements:
    _permission: 'soda scs manager admin'

entity.soda_scs_service_key.collection:
  path: '/admin/structure/soda-scs-service-key/list'
  defaults:
    _entity_list: 'soda_scs_service_key'
    _title: 'SODa SCS Service Keys'
  requirements:
    _permission: 'soda scs manager admin'

entity.soda_scs_service_key.renew_confirm_form:
  path: '/admin/structure/soda_scs_service_key/{soda_scs_service_key}/renew'
  defaults:
    _form: '\Drupal\soda_scs_manager\Form\SodaScsServiceKeyRenewConfirmForm'
    _title: 'Renew service key'
  requirements:
    _permission: 'soda scs manager admin'
  options:
    parameters:
      soda_scs_service_key:
        type: entity:soda_scs_service_key

# SODa SCS Snapshot Entities

entity.soda_scs_snapshot.add_form:
  path: '/soda-scs-manager/snapshot/add/{bundle}'
  defaults:
    _entity_form: 'soda_scs_snapshot.add'
    _title: 'Add SODa SCS Snapshot'
  requirements:
    _permission: 'soda scs manager user'

entity.soda_scs_snapshot.canonical:
  path: '/soda-scs-manager/snapshot/{soda_scs_snapshot}'
  defaults:
    _entity_view: 'soda_scs_snapshot.default'
    _title: 'SODa SCS Snapshot'
  requirements:
    _permission: 'soda scs manager user'

entity.soda_scs_snapshot.edit_form:
  path: '/soda-scs-manager/snapshot/{soda_scs_snapshot}/edit'
  defaults:
    _entity_form: 'soda_scs_snapshot.edit'
    _title: 'Edit SODa SCS Snapshot'
  requirements:
    _permission: 'soda scs manager user'

entity.soda_scs_snapshot.delete_form:
  path: '/soda-scs-manager/snapshot/{soda_scs_snapshot}/delete'
  defaults:
    _entity_form: 'soda_scs_snapshot.delete'
    _title: 'Delete SODa SCS Snapshot'
  options:
    parameters:
      soda_scs_snapshot:
        type: entity:soda_scs_snapshot
  requirements:
    _permission: 'soda scs manager user'

entity.soda_scs_snapshot.collection:
  path: '/admin/structure/soda-scs-snapshot/list'
  defaults:
    _entity_list: 'soda_scs_snapshot'
    _title: 'SODa SCS Snapshots'
  requirements:
    _permission: 'soda scs manager user'

entity.soda_scs_snapshot.restore_form:
  path: '/soda-scs-manager/snapshot/{soda_scs_snapshot}/restore'
  defaults:
    _form: 'Drupal\soda_scs_manager\Form\SodaScsSnapshotRestoreForm'
    _title: 'Restore SODa SCS Snapshot'
  requirements:
    _permission: 'soda scs manager user'
  options:
    parameters:
      soda_scs_snapshot:
        type: entity:soda_scs_snapshot


# Soda SCS Stack Entities

entity.soda_scs_stack.canonical:
  path: '/soda-scs-manager/stack/{soda_scs_stack}'
  defaults:
    _entity_view: 'soda_scs_stack.default'
    _title: 'Stack'
  options:
    parameters:
      soda_scs_stack:
        type: entity:soda_scs_stack
      bundle:
        type: string
  requirements:
    _permission: 'soda scs manager user'

entity.soda_scs_stack.add_form:
  path: '/soda-scs-manager/stack/add/{bundle}'
  defaults:
    _entity_form: 'soda_scs_stack.add'
    _title: 'Add Stack'
  requirements:
    _permission: 'soda scs manager user'

entity.soda_scs_stack.edit_form:
  path: '/soda-scs-manager/stack/{soda_scs_stack}/edit'
  defaults:
    _entity_form: 'soda_scs_stack.edit'
    _title: 'Edit Stack'
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsStackLinksTasksAccessControlHandler::accessEditForm'
  options:
    parameters:
      soda_scs_stack:
        type: entity:soda_scs_stack

entity.soda_scs_stack.delete_form:
  path: '/soda-scs-manager/stack/{soda_scs_stack}/delete'
  defaults:
    _entity_form: 'soda_scs_stack.delete'
    _title: 'Delete Stack'
  options:
    parameters:
      soda_scs_stack:
        type: entity:soda_scs_stack
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsStackLinksTasksAccessControlHandler::accessDeleteForm'


entity.soda_scs_stack.collection:
  path: '/admin/structure/soda-scs-stack/list'
  defaults:
    _entity_list: 'soda_scs_stack'
    _title: 'SODa SCS Stacks'
  requirements:
    _permission: 'soda scs manager user'

entity.soda_scs_stack.snapshot:
  path: '/soda-scs-manager/stack/{soda_scs_stack}/snapshot'
  defaults:
    _form: '\Drupal\soda_scs_manager\Form\SodaScsSnapshotConfirmForm'
    _title: 'Create Snapshot'
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsStackLinksTasksAccessControlHandler::accessSnapshotForm'
  options:
    parameters:
      soda_scs_stack:
        type: entity:soda_scs_stack

# Pages
# @todo: refactor to use entity type as parameter for just one route
soda_scs_manager.dashboard:
  path: '/soda-scs-manager/dashboard'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsManagerController::dashboardPage'
    _title:  'Dashboard'
  requirements:
    _permission: 'soda scs manager user'
  options:
    no_cache: TRUE

soda_scs_manager.debug:
  path: '/soda-scs-manager/debug'
  defaults:
    _controller: '\Drupal\system\Controller\SystemController::systemAdminMenuBlockPage'
    _title: 'Debug Tools'
  requirements:
    _permission: 'soda scs manager admin'


soda_scs_manager.start_page:
  path: '/soda-scs-manager'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsManagerController::startPage'
    _title: 'SODa SCS Manager'
  requirements:
    _permission: 'soda scs manager user'

soda_scs_manager.catalogue:
  path: '/soda-scs-manager/catalogue'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsManagerController::cataloguePage'
    _title: 'Catalogue'
  requirements:
    _permission: 'soda scs manager user'

soda_scs_manager.notifications:
  path: '/soda-scs-manager/notifications'
  defaults:
    _form: '\Drupal\soda_scs_manager\Form\SodaScsProjectMembershipForm'
    _title: 'Notifications'
  requirements:
    _permission: 'soda scs manager user'
  options:
    no_cache: TRUE

soda_scs_manager.administration:
  path: '/soda-scs-manager/administration'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsAdministrationController::administrationPage'
    _title: 'SCS Administration'
  requirements:
    _permission: 'soda scs manager user'

soda_scs_manager.settings:
  path: '/admin/config/soda-scs-manager/settings'
  defaults:
    _form: '\Drupal\soda_scs_manager\Form\SodaScsSettingsForm'
    _title:  'SCS Settings'
  requirements:
    _permission: 'soda scs manager admin'

soda_scs_manager.tour:
  path: '/soda-scs-manager/tour'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsManagerController::tourPage'
    _title: 'Beginners Tour'
  requirements:
    _permission: 'soda scs manager user'

## Menu items for the main navigation

soda_scs_manager.menu.default:
  path: '/soda-scs-manager'
  defaults:
    _title: 'Start page'
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsManagerController::startPage'
  requirements:
    _permission: 'soda scs manager user'

# Keycloak User Registration

soda_scs_manager.user_registration:
  path: '/user/register'
  defaults:
    _form: '\Drupal\soda_scs_manager\Form\KeycloakUserRegistrationForm'
    _title: 'Register for an account'
  requirements:
    _access: 'TRUE'
  options:
    _admin_route: FALSE

soda_scs_manager.user_registration_approvals:
  path: '/admin/people/keycloak-registrations'
  defaults:
    _form: '\Drupal\soda_scs_manager\Form\KeycloakUserApprovalForm'
    _title: 'Keycloak User Registrations'
  requirements:
    _permission: 'administer users'
  options:
    _admin_route: TRUE

soda_scs_manager.user_registration_approve:
  path: '/admin/people/keycloak-registrations/{id}/approve'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Form\KeycloakUserApprovalForm::approveRegistration'
    _title: 'Approve User Registration'
  requirements:
    _permission: 'administer users'
  options:
    _admin_route: TRUE
    parameters:
      id:
        type: integer

soda_scs_manager.user_registration_reject:
  path: '/admin/people/keycloak-registrations/{id}/reject'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Form\KeycloakUserApprovalForm::rejectRegistration'
    _title: 'Reject User Registration'
  requirements:
    _permission: 'administer users'
  options:
    _admin_route: TRUE
    parameters:
      id:
        type: integer

# Issue Reporting
soda_scs_manager.issue_report:
  path: '/soda-scs-manager/issue-report'
  defaults:
    _form: '\Drupal\soda_scs_manager\Form\SodaScsIssueReportForm'
    _title: 'Issue Report'
  requirements:
    _permission: 'soda scs manager user'
  options:
    no_cache: TRUE

# Tasks

soda_scs_manager.component.check_drupal_packages:
  path: '/soda-scs-manager/component/check-drupal-packages/{soda_scs_component}'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsComponentController::checkDrupalPackages'
    _title: 'Check Drupal packages'
  requirements:
    _permission: 'soda scs manager admin'
  options:
    parameters:
      soda_scs_component:
        type: entity:soda_scs_component
    no_cache: TRUE

soda_scs_manager.component.installed_drupal_packages:
  path: '/soda-scs-manager/component/installed-drupal-packages/{soda_scs_component}'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsComponentController::installedDrupalPackages'
    _title: 'Installed Drupal packages'
  requirements:
    _permission: 'soda scs manager admin'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsComponentLinksTasksAccessControlHandler::accessInstalledDrupalPackagesTask'
  options:
    parameters:
      soda_scs_component:
        type: entity:soda_scs_component
    no_cache: TRUE

soda_scs_manager.component.installed_drupal_packages_json:
  path: '/soda-scs-manager/component/installed-drupal-packages/{soda_scs_component}/json'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsComponentController::installedDrupalPackagesJson'
    _title: 'Installed Drupal packages (JSON)'
  requirements:
    _permission: 'soda scs manager admin'
  options:
    parameters:
      soda_scs_component:
        type: entity:soda_scs_component
    no_cache: TRUE

soda_scs_manager.component.set_package_environment:
  path: '/soda-scs-manager/component/set-package-environment/{soda_scs_component}'
  defaults:
    _form: '\Drupal\soda_scs_manager\Form\SodaScsComponentSetPackageEnvironmentConfirmForm'
    _title: 'Set package environment'
  requirements:
    _permission: 'soda scs manager admin'
  options:
    parameters:
      soda_scs_component:
        type: entity:soda_scs_component
    query:
      operation_uuid: string
    no_cache: TRUE

soda_scs_manager.component.service_link:
  path: '/soda-scs-manager/component/service-link/{soda_scs_component}'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsManagerServiceController::generateComponentUrl'
    _title: 'External service link'
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsComponentLinksTasksAccessControlHandler::accessServiceLink'
  options:
    parameters:
      soda_scs_component:
        type: entity:soda_scs_component

soda_scs_manager.component.service_url_json:
  path: '/soda-scs-manager/component/service-url/{soda_scs_component}'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsManagerServiceController::getComponentServiceUrl'
    _title: 'Get service URL'
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsComponentLinksTasksAccessControlHandler::accessServiceLink'
  options:
    parameters:
      soda_scs_component:
        type: entity:soda_scs_component
    no_cache: TRUE

soda_scs_manager.stack.service_link:
  path: '/soda-scs-manager/stack/service-link/{soda_scs_stack}'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsManagerServiceController::generateStackUrl'
    _title: 'External service link'
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsStackLinksTasksAccessControlHandler::accessServiceLink'
  options:
    parameters:
      soda_scs_stack:
        type: entity:soda_scs_stack

soda_scs_manager.stack.service_url_json:
  path: '/soda-scs-manager/stack/service-url/{soda_scs_stack}'
  defaults:
    _controller: '\Drupal\soda_scs_manager\Controller\SodaScsManagerServiceController::getStackServiceUrl'
    _title: 'Get service URL'
  requirements:
    _permission: 'soda scs manager user'
    _custom_access: '\Drupal\soda_scs_manager\Access\SodaScsStackLinksTasksAccessControlHandler::accessServiceLink'
  options:
    parameters:
      soda_scs_stack:
        type: entity:soda_scs_stack
    no_cache: TRUE

soda_scs_manager.snapshot_debug:
  path: '/soda-scs-manager/debug/snapshots'
  defaults:
    _title: 'Snapshot Debug Tools'
    _form: '\Drupal\soda_scs_manager\Form\SodaScsSnapshotDebugForm'
  requirements:
    _permission: 'soda scs manager admin'

